<%
  group_labels = {
    "inbox" => "Inbox",
    "today" => "Today",
    "computer" => "Computer",
    "calls" => "Calls",
    "outside" => "Outside",
    "home" => "Home",
    "waiting_for" => "Waiting For",
    "someday" => "Some day"
  }
  is_inbox = group == "inbox"
  is_today = group == "today"

  group_class = if is_inbox
    'task-group task-group--inbox'
  elsif is_today
    'task-group task-group--today'
  else
    'task-group task-group--regular'
  end
%>

<div id="<%= dom_id_for_group(group) %>"
     class="<%= group_class %>"
     data-controller="task-group"
     data-task-group-name-value="<%= group %>">

  <!-- Header -->
  <div class="task-group__header">
    <h2 class="task-group__title">
      <%= group_labels[group] %>
      <span class="task-group__count">(<%= tasks.count %>)</span>
    </h2>
    <% if is_inbox %>
      <button type="button"
              class="task-group__add-btn"
              data-action="click->task-group#showNewTaskForm">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4" />
        </svg>
      </button>
    <% end %>
  </div>

  <!-- New Task Form (hidden by default, only for Inbox) -->
  <% if is_inbox %>
    <div data-task-group-target="newTaskForm" class="hidden">
      <%= form_with url: tasks_path, method: :post, class: "new-task-form", data: { turbo_frame: "_top", action: "submit->task-group#createTask" } do |f| %>
        <%= f.text_field :title,
            placeholder: "What needs to be done?",
            class: "new-task-form__input",
            data: { task_group_target: "newTaskInput" } %>
        <%= f.date_field :due_date,
            class: "new-task-form__date",
            placeholder: "Due date" %>
        <%= f.submit "Add", class: "new-task-form__submit" %>
      <% end %>
    </div>
  <% end %>

  <!-- Task List -->
  <div class="task-group__list"
       data-task-group-target="taskList"
       data-controller="sortable"
       data-sortable-group-value="<%= group %>">
    <% tasks.each do |task| %>
      <%= render "plan/task_row", task: task %>
    <% end %>
    <% if tasks.empty? %>
      <p class="task-group__empty empty-message">No tasks yet</p>
    <% end %>
  </div>
</div>
