<div id="<%= dom_id(task) %>"
     class="task-row group"
     data-controller="task-row"
     data-task-row-id-value="<%= task.id %>"
     data-task-id="<%= task.id %>">

  <!-- Drag Handle -->
  <div data-drag-handle class="task-row__drag">
    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="currentColor" viewBox="0 0 24 24">
      <circle cx="9" cy="5" r="1.5" />
      <circle cx="15" cy="5" r="1.5" />
      <circle cx="9" cy="12" r="1.5" />
      <circle cx="15" cy="12" r="1.5" />
      <circle cx="9" cy="19" r="1.5" />
      <circle cx="15" cy="19" r="1.5" />
    </svg>
  </div>

  <!-- Checkbox -->
  <button type="button"
          class="task-row__checkbox <%= task.completed? ? 'task-row__checkbox--checked' : '' %>"
          data-action="click->task-row#toggleComplete">
    <% if task.completed? %>
      <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="3">
        <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
      </svg>
    <% end %>
  </button>

  <!-- Title -->
  <span class="task-row__title <%= task.completed? ? 'task-row__title--completed' : '' %>">
    <%= task.title %>
  </span>

  <!-- Source Badge -->
  <% if task.basecamp? %>
    <span class="task-row__badge task-row__badge--basecamp">BC</span>
    <a href="<%= task.basecamp_url %>" target="_blank" rel="noopener"
       class="task-row__actions-btn" title="Open in Basecamp">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-3.5 w-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
      </svg>
    </a>
  <% else %>
    <span class="task-row__badge task-row__badge--personal">P</span>
  <% end %>

  <!-- Due date -->
  <% if task.personal? %>
    <!-- Editable date for personal tasks -->
    <span data-task-row-target="dateDisplay"
          data-action="click->task-row#editDate"
          class="task-row__date <%= task.due_date.present? && task.due_date < Date.current ? 'task-row__date--overdue' : '' %>">
      <%= task.due_date.present? ? task.due_date.strftime("%-m/%-d") : "No date" %>
    </span>
    <input type="date"
           data-task-row-target="dateInput"
           data-action="change->task-row#saveDate blur->task-row#cancelDateEdit"
           value="<%= task.due_date&.to_s %>"
           class="hidden w-24 rounded border px-1 py-0.5 text-xs focus:outline-none new-task-form__date">
  <% elsif task.due_date %>
    <!-- Read-only date for Basecamp tasks -->
    <span class="task-row__date task-row__date--locked <%= task.due_date < Date.current ? 'task-row__date--overdue' : '' %>">
      <%= task.due_date.strftime("%-m/%-d") %>
      <svg xmlns="http://www.w3.org/2000/svg" class="inline h-3 w-3 ml-0.5 opacity-50" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" title="Synced from Basecamp">
        <path stroke-linecap="round" stroke-linejoin="round" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
      </svg>
    </span>
  <% end %>

  <!-- Actions dropdown (visible on hover) -->
  <div class="task-row__actions" data-controller="dropdown">
    <button type="button"
            class="task-row__actions-btn"
            data-action="click->dropdown#toggle">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z" />
      </svg>
    </button>
    <div data-dropdown-target="menu"
         class="task-row__dropdown hidden">
      <% Task::GROUPS.each do |target_group| %>
        <% next if target_group == task.group %>
        <button type="button"
                class="task-row__dropdown-item"
                data-action="click->task-row#moveTo"
                data-group="<%= target_group %>">
          Move to <%= target_group.titleize %>
        </button>
      <% end %>
      <hr class="my-1 border-[var(--stone-200)]">
      <button type="button"
              class="task-row__dropdown-item task-row__dropdown-item--danger"
              data-action="click->task-row#archive">
        Archive
      </button>
    </div>
  </div>
</div>
