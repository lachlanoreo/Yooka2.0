<div class="flex min-h-full gap-6 p-12">
  <!-- Left Pane: Task Groups -->
  <div class="yooka-panel w-1/2 p-5">
    <div class="space-y-5">
      <% Task::GROUPS.each_with_index do |group, index| %>
        <div class="animate-fade-in opacity-0 animate-delay-<%= index + 1 %>">
          <%= render "plan/task_group", group: group, tasks: @tasks_by_group[group] %>
        </div>
      <% end %>
    </div>

    <!-- Completed Tasks Section -->
    <div class="animate-fade-in opacity-0 animate-delay-8">
      <%= render "plan/completed_section", completed_tasks: @completed_tasks %>
    </div>
  </div>

  <!-- Right Pane: Calendar Day View -->
  <div class="yooka-panel w-1/2 p-5 flex flex-col h-[calc(100vh-6rem)]">
    <!-- Calendar with Date Navigation (Turbo Frame for date switching) -->
    <div class="animate-fade-in opacity-0 animate-delay-1 flex-grow flex flex-col min-h-0">
      <%= render "plan/calendar_frame",
          viewed_date: @viewed_date,
          daily_goal: @daily_goal,
          time_blocks: @time_blocks,
          google_events: @google_events,
          frozen: @frozen %>
    </div>

    <!-- Integration Status -->
    <div class="mt-5 space-y-3 animate-fade-in opacity-0 animate-delay-3 flex-shrink-0">
      <% if @google_connected %>
        <div class="connection-card connection-card--connected">
          <p class="connection-card__status connection-card__status--connected">Google Calendar connected</p>
        </div>
      <% else %>
        <div class="connection-card connection-card--disconnected">
          <p class="connection-card__status connection-card__status--disconnected">Google Calendar not connected</p>
          <%= link_to "Connect", "/auth/google_oauth2", method: :post, class: "connection-card__action connection-card__action--connect", data: { turbo: false } %>
        </div>
      <% end %>

      <% if @basecamp_connected %>
        <div class="connection-card connection-card--connected" data-controller="basecamp-sync">
          <p class="connection-card__status connection-card__status--connected">Basecamp connected</p>
          <button type="button"
                  class="connection-card__action connection-card__action--sync flex items-center gap-2"
                  data-basecamp-sync-target="button"
                  data-action="click->basecamp-sync#sync">
            <span data-basecamp-sync-target="buttonText">Sync Now</span>
            <svg class="animate-spin h-4 w-4 hidden" data-basecamp-sync-target="spinner" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
              <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
          </button>
        </div>
      <% else %>
        <div class="connection-card connection-card--disconnected">
          <p class="connection-card__status connection-card__status--disconnected">Basecamp not connected</p>
          <%
            # Use 127.0.0.1 instead of request.base_url to match registered redirect URI
            redirect_uri = "http://127.0.0.1:#{request.port}/auth/basecamp/callback"
            basecamp_auth_url = "https://launchpad.37signals.com/authorization/new?" + {
              type: 'web_server',
              client_id: ENV['BASECAMP_CLIENT_ID'],
              redirect_uri: redirect_uri
            }.to_query
          %>
          <%= link_to "Connect", basecamp_auth_url, class: "connection-card__action connection-card__action--connect" %>
        </div>
      <% end %>
    </div>
  </div>
</div>
